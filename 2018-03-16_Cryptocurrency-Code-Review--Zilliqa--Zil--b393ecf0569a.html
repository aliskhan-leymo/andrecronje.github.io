<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Cryptocurrency Code Review: Zilliqa (Zil)</title><meta name="description" content="Disclaimer: These reviews are done as is from what is on display in the master branch of the repo’s made available. This review is not a…"><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Cryptocurrency Code Review: Zilliqa (Zil)</h1>
</header>
<section data-field="subtitle" class="p-summary">
Disclaimer: These reviews are done as is from what is on display in the master branch of the repo’s made available. This review is not a…
</section>
<section data-field="body" class="e-content">
<section name="6058" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="4281" id="4281" class="graf graf--h3 graf--leading graf--title">Cryptocurrency Code Review: Zilliqa (Zil)</h3><p name="9554" id="9554" class="graf graf--p graf-after--h3"><strong class="markup--strong markup--p-strong">Disclaimer</strong>: These reviews are done as is from what is on display in the master branch of the repo’s made available. This review is not a comment on the overall project, scope, or success thereof. This was done as an educational review by me and any comments in the article are simply my opinion. It should not be used as any comment or advice on the project as a whole.</p><p name="d77f" id="d77f" class="graf graf--p graf-after--p">==EDIT 17/03/2018: Yaoqi Jia (Head of Technology @ Zilliqa) responded to the article, his full comments in the comment section, I have incorporated the relevant statements for the article in quotes, my comments following if any;</p><ul class="postList"><li name="5d0d" id="5d0d" class="graf graf--li graf--startsWithDoubleQuote graf-after--p">“Local machine tests are quite constrained by the machine’s computing resources, and are thus inaccurate in estimating the throughput of a real blockchain network…” <strong class="markup--strong markup--li-strong">Me</strong>: This is why I went for a c5.2xlarge, I figured the 16 gigs should be enough and the 8 vCPU and 31 ECU should give it a good run for money.</li><li name="c0bb" id="c0bb" class="graf graf--li graf--startsWithDoubleQuote graf-after--li">“…the way to measure TPS needs to be on the actual number of transactions processed by the blockchain, rather than those sent to nodes.” <strong class="markup--strong markup--li-strong">Me</strong>: The article did not make it clear, but this was the metric used, the second timestamp was triggered by a log watcher when completion of all the transactions occured, so this is how TPS was measured in the article</li><li name="18d1" id="18d1" class="graf graf--li graf--startsWithDoubleQuote graf-after--li">“We are preparing testnet for public participation and working on wallets for users to send valid transactions to our testnet in a convenient way.”</li><li name="b618" id="b618" class="graf graf--li graf--startsWithDoubleQuote graf-after--li">“Due to a different design and different consensus mechanism (pBFT-like in Zilliqa), PoW difficulty isn’t a key factor in determining the throughput in Zilliqa.” <strong class="markup--strong markup--li-strong">Me</strong>: so this is why in the article difficulty did not effect the outcome</li><li name="e6a4" id="e6a4" class="graf graf--li graf--startsWithDoubleQuote graf-after--li">“We note the points raised on Ethereum’s scaling solutions in the last section. While, the concept of sharding is easy to understand, it is notoriously difficult to do it right. Ethereum is indeed working hard on their state sharding proposal, but we believe that there are multiple open-research challenges ahead, e.g., overhead of cross-shard communication and data transmission across nodes after reshuffling among others. On the Zilliqa side, we have a working implementation of sharding which we believe gives us a good headstart. While competition is always good for the general health of the ecosystem, there is much more to learn from the successes and failures of both the projects.”</li></ul><p name="0358" id="0358" class="graf graf--p graf-after--li">==</p><figure name="a960" id="a960" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 613px; max-height: 202px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 33%;"></div><img class="graf-image" data-image-id="1*_vgZLvJkdhZgBTPfZgpJ4A.png" data-width="613" data-height="202" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*_vgZLvJkdhZgBTPfZgpJ4A.png"></div></figure><p name="88bc" id="88bc" class="graf graf--p graf-after--figure">Today we look at Zilliqa, the thing that zilliqa attributes to their speed is their sharding implementation. This means they can scale shards horizontally (add more nodes). Quick explanation here, scaling vertically means scaling to use more resources, for example leverage a core cpu instead of a single cpu, or using more RAM, this is vertical scaling, horizontal scaling is adding more machines into a network and having them actually increase throughput. Current blockchains do not scale horizontally because each node is a replicate of the next, with sharding horizontal scaling is possible.</p><p name="38f1" id="38f1" class="graf graf--p graf-after--p">Now Zilliqa’s code base is not small, it looks small, but don’t be fooled;</p><figure name="7d36" id="7d36" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 485px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 69.3%;"></div><img class="graf-image" data-image-id="1*nZ4jiDq8eVbFrTQ19Z0g3w.png" data-width="923" data-height="640" src="https://cdn-images-1.medium.com/max/800/1*nZ4jiDq8eVbFrTQ19Z0g3w.png"></div></figure><p name="9176" id="9176" class="graf graf--p graf-after--figure">Only 313 commits, but it is a lot of code, so for the sake of this article I decided to go another route, let’s actually run a cluster of Zilliqa nodes. 10 nodes and 1 DS</p><p name="6d73" id="6d73" class="graf graf--p graf-after--p">Zilliqa states minimum requirements as 2 GB ram, let’s test this.</p><figure name="acc1" id="acc1" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 98px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 14.099999999999998%;"></div><img class="graf-image" data-image-id="1*NX7-_h-4Pi4HE3miwsGWuQ.png" data-width="939" data-height="132" src="https://cdn-images-1.medium.com/max/800/1*NX7-_h-4Pi4HE3miwsGWuQ.png"></div></figure><p name="2f7a" id="2f7a" class="graf graf--p graf-after--figure">Booted a clean new ubuntu 16.04 LTS with 1 gig ram, tried to run their installation command and had a failure. The fix by the way is easy enough, just run</p><pre name="11bf" id="11bf" class="graf graf--pre graf-after--p">sudo apt-get update; sudo apt-get install build-essential</pre><p name="27b3" id="27b3" class="graf graf--p graf-after--pre">If anyone from Zilliqa read this, maybe just add that in as well for a fresh install.</p><figure name="21fa" id="21fa" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 470px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 67.2%;"></div><img class="graf-image" data-image-id="1*NArc8EDT8qFeZ95xErNu3A.png" data-width="942" data-height="633" src="https://cdn-images-1.medium.com/max/800/1*NArc8EDT8qFeZ95xErNu3A.png"></div></figure><p name="7eb5" id="7eb5" class="graf graf--p graf-after--figure">Memory exhausted. Guess they were right, 1 Gig is definitely not enough, booted a 16 Gig machine</p><figure name="bc59" id="bc59" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 349px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 49.8%;"></div><img class="graf-image" data-image-id="1*heZcWraL9F52XHMxdn7ocg.png" data-width="938" data-height="467" src="https://cdn-images-1.medium.com/max/800/1*heZcWraL9F52XHMxdn7ocg.png"></div></figure><p name="24cb" id="24cb" class="graf graf--p graf-after--figure">After I had my node set up I wanted to do a transaction tests, unfortunately create transaction isn’t implemented yet, but we have the send transaction option, so not end of the world</p><figure name="a532" id="a532" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 680px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 97.2%;"></div><img class="graf-image" data-image-id="1*B4gzUL9fKxxqQwP4F7XN4w.png" data-width="815" data-height="792" src="https://cdn-images-1.medium.com/max/800/1*B4gzUL9fKxxqQwP4F7XN4w.png"></div></figure><p name="d3e3" id="d3e3" class="graf graf--p graf-after--figure">Nodes up and running, we are golden. This was fairly painless in comparison to most, good job so far Zilliqa team.</p><figure name="940a" id="940a" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 734px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 104.80000000000001%;"></div><img class="graf-image" data-image-id="1*oJ7OFcKgHptcrd5PrWj9DQ.png" data-width="938" data-height="983" src="https://cdn-images-1.medium.com/max/800/1*oJ7OFcKgHptcrd5PrWj9DQ.png"></div></figure><p name="f57d" id="f57d" class="graf graf--p graf-after--figure">And we are active, so let’s look at that send transaction</p><figure name="6f8f" id="6f8f" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 432px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 61.7%;"></div><img class="graf-image" data-image-id="1*25Gw5ro9uT4tY3wgQNxJiQ.png" data-width="870" data-height="537" src="https://cdn-images-1.medium.com/max/800/1*25Gw5ro9uT4tY3wgQNxJiQ.png"></div></figure><p name="e1c4" id="e1c4" class="graf graf--p graf-after--figure">Straight forward enough, send the dummy transaction data to the node of my choice, this is actually perfect since I can use this to run TPS checks, so I set this to 10 000 transactions.</p><figure name="ffcd" id="ffcd" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 651px; max-height: 149px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 22.900000000000002%;"></div><img class="graf-image" data-image-id="1*sE5ATfyQyOWk1kcxFh0ovA.png" data-width="651" data-height="149" src="https://cdn-images-1.medium.com/max/800/1*sE5ATfyQyOWk1kcxFh0ovA.png"></div></figure><p name="417d" id="417d" class="graf graf--p graf-after--figure">Bad move, 32 minutes later I kill the process, look at that load average above, a load average should never be above 1, we are sitting on 348, my nodes were dying!</p><figure name="dac0" id="dac0" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 55px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 7.9%;"></div><img class="graf-image" data-image-id="1*sGNr3APTJpkM7fh8JKmG-Q.png" data-width="936" data-height="74" src="https://cdn-images-1.medium.com/max/800/1*sGNr3APTJpkM7fh8JKmG-Q.png"></div></figure><p name="e00e" id="e00e" class="graf graf--p graf-after--figure">Ok, so the 10 nodes might be too much replication, let’s switch to 3 active nodes</p><figure name="9957" id="9957" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 445px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 63.6%;"></div><img class="graf-image" data-image-id="1*9mp7MdSp7i-5AFPwV0PJ4w.png" data-width="942" data-height="599" src="https://cdn-images-1.medium.com/max/800/1*9mp7MdSp7i-5AFPwV0PJ4w.png"></div></figure><p name="b436" id="b436" class="graf graf--p graf-after--figure">3 nodes changed, and let’s run again, this time a bit more conservative, let’s just do 1000 transactions.</p><figure name="ca5e" id="ca5e" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 113px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 16.1%;"></div><img class="graf-image" data-image-id="1*OSKut0OaLKvlgJya1VF6pQ.png" data-width="745" data-height="120" src="https://cdn-images-1.medium.com/max/800/1*OSKut0OaLKvlgJya1VF6pQ.png"></div></figure><p name="26e7" id="26e7" class="graf graf--p graf-after--figure">8 minutes later and we kill again. Something isn’t right here</p><figure name="8b9b" id="8b9b" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 106px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 15.1%;"></div><img class="graf-image" data-image-id="1*3kxDX-DMBKxlD3Tp7vUosQ.png" data-width="748" data-height="113" src="https://cdn-images-1.medium.com/max/800/1*3kxDX-DMBKxlD3Tp7vUosQ.png"></div></figure><p name="16f5" id="16f5" class="graf graf--p graf-after--figure">Ok, changed back to 1, and we took 13 seconds. We have a look again at the line calling the transaction, looks straight forward enough, sends the message to the node.</p><figure name="b168" id="b168" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 431px; max-height: 23px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 5.3%;"></div><img class="graf-image" data-image-id="1*l5VaB1Au9jtLFks6CD_fyw.png" data-width="431" data-height="23" src="https://cdn-images-1.medium.com/max/800/1*l5VaB1Au9jtLFks6CD_fyw.png"></div></figure><p name="e8f2" id="e8f2" class="graf graf--p graf-after--figure">Something is happening here that I don’t quite understand yet, because even though it is sending 1 message, it is not creating 1 message</p><figure name="be7b" id="be7b" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 27px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 3.9%;"></div><img class="graf-image" data-image-id="1*_U1m_kEn7Ylzl7N8jwD65A.png" data-width="895" data-height="35" src="https://cdn-images-1.medium.com/max/800/1*_U1m_kEn7Ylzl7N8jwD65A.png"></div></figure><p name="6d18" id="6d18" class="graf graf--p graf-after--figure">It’s creating 10 000 messages, no wonder both my x1000 (10 000 000 messages) and my x100 (1000 000 messages) had to be killed.</p><figure name="038b" id="038b" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 665px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 95.1%;"></div><img class="graf-image" data-image-id="1*gYD0-l4nPWwL59IxzfMsEw.png" data-width="932" data-height="886" src="https://cdn-images-1.medium.com/max/800/1*gYD0-l4nPWwL59IxzfMsEw.png"></div></figure><p name="ba76" id="ba76" class="graf graf--p graf-after--figure">So let’s have a look what is actually going on here;</p><figure name="a582" id="a582" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 588px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 84%;"></div><img class="graf-image" data-image-id="1*_xQC4aIQGqN8Cl8bktwLPA.png" data-width="706" data-height="593" src="https://cdn-images-1.medium.com/max/800/1*_xQC4aIQGqN8Cl8bktwLPA.png"></div></figure><p name="3695" id="3695" class="graf graf--p graf-after--figure">indexes = peers (3) in my latest attempt. A group of jobs are created that will all execute sendMessageCore. Although this should be 3, not 10k.</p><p name="0572" id="0572" class="graf graf--p graf-after--p">This is kind of a lot of unnecessary code to just do a random select on a few peers, but I’ll ignore that for now, let’s look at SendMessageCore</p><figure name="f9a4" id="f9a4" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 659px; max-height: 362px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 54.900000000000006%;"></div><img class="graf-image" data-image-id="1*sK2HyZ-YQRKWWdiWJKTasQ.png" data-width="659" data-height="362" src="https://cdn-images-1.medium.com/max/800/1*sK2HyZ-YQRKWWdiWJKTasQ.png"></div></figure><p name="1b89" id="1b89" class="graf graf--p graf-after--figure">Just another nested loop, now we are looking for SendMessageSocketCore, I’m not a fan of the sleep here, especially not with the random modulus PUMPMESSAGE_MILLISECONDS, but let’s first hunt down SendMessageSocketCore</p><figure name="a331" id="a331" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 139px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 19.900000000000002%;"></div><img class="graf-image" data-image-id="1*G7Ih1JHEysWoR6P5GLyFrQ.png" data-width="700" data-height="139" src="https://cdn-images-1.medium.com/max/800/1*G7Ih1JHEysWoR6P5GLyFrQ.png"></div></figure><p name="e0e3" id="e0e3" class="graf graf--p graf-after--figure">It’s a long function, so just going to look for the interesting bits</p><figure name="37d1" id="37d1" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 417px; max-height: 124px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 29.7%;"></div><img class="graf-image" data-image-id="1*o4Ap6JavLeP9CuH1nZLHCQ.png" data-width="417" data-height="124" src="https://cdn-images-1.medium.com/max/800/1*o4Ap6JavLeP9CuH1nZLHCQ.png"></div></figure><p name="3875" id="3875" class="graf graf--p graf-after--figure">Come on guys, error handling 101, never do a catch all, OOM (Out Of Memory) errors are also going to hit here, even kernel panics, this is very dangerous.</p><p name="83dd" id="83dd" class="graf graf--p graf-after--p">But I don’t see where the 10k transactions are coming from… Nothing in SendMessageSocketCore is inflating them, it’s just standard socket behavior.</p><p name="69dd" id="69dd" class="graf graf--p graf-after--p">Ok, I was looking at the wrong message signature, this is the correct one;</p><figure name="cfa7" id="cfa7" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 564px; max-height: 135px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 23.9%;"></div><img class="graf-image" data-image-id="1*Nv_ipjHo8qlkWTSHBG7Ufw.png" data-width="564" data-height="135" src="https://cdn-images-1.medium.com/max/800/1*Nv_ipjHo8qlkWTSHBG7Ufw.png"></div></figure><p name="33f1" id="33f1" class="graf graf--p graf-after--figure">But this doesn’t actually change anything. I ignored my current route of investigation and instead opted for another;</p><figure name="7ab6" id="7ab6" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 615px; max-height: 221px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 35.9%;"></div><img class="graf-image" data-image-id="1*Q72yHtYMGtYLBs5aTm9Wng.png" data-width="615" data-height="221" src="https://cdn-images-1.medium.com/max/800/1*Q72yHtYMGtYLBs5aTm9Wng.png"></div></figure><p name="88e3" id="88e3" class="graf graf--p graf-after--figure">This is our transaction sender, let’s see how it gets called</p><figure name="b4f8" id="b4f8" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 323px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 46.1%;"></div><img class="graf-image" data-image-id="1*0uRajDvUa9gultLLRI8qeg.png" data-width="866" data-height="399" src="https://cdn-images-1.medium.com/max/800/1*0uRajDvUa9gultLLRI8qeg.png"></div></figure><p name="de6f" id="de6f" class="graf graf--p graf-after--figure">Ok, so this happens for all internal created transactions. No matter what transaction you send, it will be duplicated 10k times by the node as soon as it is sent. A warning or a disclaimer here would be nice Zilliqa team! How was I suppose to know!</p><p name="750b" id="750b" class="graf graf--p graf-after--p">But ok, this means 769 TPS per second on a single static node.</p><p name="95d5" id="95d5" class="graf graf--p graf-after--p">This however does mean we can still test bigger transaction numbers (pity I didn’t know this at the start, could have done more conclusive tests then), so a few more 10k tests to set the median</p><figure name="b65d" id="b65d" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 63px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 9%;"></div><img class="graf-image" data-image-id="1*GiFd3OE3C5OtYBCiQdE20g.png" data-width="745" data-height="67" src="https://cdn-images-1.medium.com/max/800/1*GiFd3OE3C5OtYBCiQdE20g.png"></div></figure><p name="feda" id="feda" class="graf graf--p graf-after--figure">1k TPS</p><figure name="fcb7" id="fcb7" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 76px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 10.9%;"></div><img class="graf-image" data-image-id="1*mbr65k4Z4lrVovdOBou1ug.png" data-width="735" data-height="80" src="https://cdn-images-1.medium.com/max/800/1*mbr65k4Z4lrVovdOBou1ug.png"></div></figure><p name="1e2c" id="1e2c" class="graf graf--p graf-after--figure">1.4k TPS, 1.25k TPS, 1.25k TPS.</p><p name="b801" id="b801" class="graf graf--p graf-after--p">Looks pretty stable between 1k and 1.4k TPS, but now let’s remember these are being generated internally in the code, so don’t get excited just yet. Next we are going to change the loop (to only generate 1 message) and then actually send in 10k transactions, and see the difference.</p><figure name="67dd" id="67dd" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 442px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 63.1%;"></div><img class="graf-image" data-image-id="1*8kLE00zh33PcbapUULZcCg.png" data-width="792" data-height="500" src="https://cdn-images-1.medium.com/max/800/1*8kLE00zh33PcbapUULZcCg.png"></div></figure><p name="6f84" id="6f84" class="graf graf--p graf-after--figure">Rebuilt, so let’s run our network test.</p><figure name="fd7f" id="fd7f" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 63px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 8.9%;"></div><img class="graf-image" data-image-id="1*fqo7dToz4AmomFhxxm-wGA.png" data-width="739" data-height="66" src="https://cdn-images-1.medium.com/max/800/1*fqo7dToz4AmomFhxxm-wGA.png"></div></figure><p name="c90d" id="c90d" class="graf graf--p graf-after--figure">200 TPS, that was on 1k messages, let’s try 10k.</p><figure name="e850" id="e850" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 335px; max-height: 57px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 17%;"></div><img class="graf-image" data-image-id="1*-4YMHII9yqBCvMs3lgi_4Q.png" data-width="335" data-height="57" src="https://cdn-images-1.medium.com/max/800/1*-4YMHII9yqBCvMs3lgi_4Q.png"></div></figure><p name="b5e2" id="b5e2" class="graf graf--p graf-after--figure">312 TPS on 10k, let’s run a few more samples;</p><p name="ff64" id="ff64" class="graf graf--p graf-after--p">270 TPS, 294 TPS.</p><p name="45a7" id="45a7" class="graf graf--p graf-after--p">Ok, so this looks to be about the average TPS we are looking at. But what I want to know now, is what kind of nonce are we using on the difficulty</p><p name="aa43" id="aa43" class="graf graf--p graf-after--p">Using EtHash</p><figure name="f37f" id="f37f" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 342px; max-height: 298px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 87.1%;"></div><img class="graf-image" data-image-id="1*wE0PCcQeXPdLyLGV-p2D9Q.png" data-width="342" data-height="298" src="https://cdn-images-1.medium.com/max/800/1*wE0PCcQeXPdLyLGV-p2D9Q.png"></div></figure><p name="8736" id="8736" class="graf graf--p graf-after--figure">So we know EtHash, and we know we are currently running on a difficulty of 3</p><figure name="fe77" id="fe77" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 556px; max-height: 466px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 83.8%;"></div><img class="graf-image" data-image-id="1*ynxasulTUNv9TO8eMZvY7A.png" data-width="556" data-height="466" src="https://cdn-images-1.medium.com/max/800/1*ynxasulTUNv9TO8eMZvY7A.png"></div></figure><p name="dd2e" id="dd2e" class="graf graf--p graf-after--figure">What difficulty is Ethereum running?</p><figure name="98f1" id="98f1" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 351px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 50.2%;"></div><img class="graf-image" data-image-id="1*_OpfVP1JcupxoiU2BOEsYg.png" data-width="1193" data-height="599" src="https://cdn-images-1.medium.com/max/800/1*_OpfVP1JcupxoiU2BOEsYg.png"></div></figure><p name="1849" id="1849" class="graf graf--p graf-after--figure">3235260263133829.5 Ethereum difficulty. So, I’m definitely not increasing it to that, let’s increase it to 1000 and check again.</p><figure name="7d60" id="7d60" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 254px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 36.4%;"></div><img class="graf-image" data-image-id="1*mouAOZpvL_qqqFZmG1oKzA.png" data-width="828" data-height="301" src="https://cdn-images-1.medium.com/max/800/1*mouAOZpvL_qqqFZmG1oKzA.png"></div></figure><p name="e953" id="e953" class="graf graf--p graf-after--figure">Doesn’t look like it’s going to be that simple, thought the difficulty was taken from constants_local.xml, but this isn’t actually being used.</p><p name="e807" id="e807" class="graf graf--p graf-after--p">Guess I was wrong, looks like it’s hardcoded in here, and now to find out which parameter it is.</p><figure name="c206" id="c206" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 522px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 74.5%;"></div><img class="graf-image" data-image-id="1*Kj_QgNG3-13g2om9C-NDkA.png" data-width="922" data-height="687" src="https://cdn-images-1.medium.com/max/800/1*Kj_QgNG3-13g2om9C-NDkA.png"></div></figure><figure name="cb4b" id="cb4b" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 668px; max-height: 23px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 3.4000000000000004%;"></div><img class="graf-image" data-image-id="1*68uqHxi0lmbK9KP0SNuSow.png" data-width="668" data-height="23" src="https://cdn-images-1.medium.com/max/800/1*68uqHxi0lmbK9KP0SNuSow.png"></div></figure><p name="36ca" id="36ca" class="graf graf--p graf-after--figure">Ok, that wasn’t super annoying, but nodes 1–10 are preconfigured as DS nodes, we need to change that to only node 1 is a DS node and node 2–3 are normal nodes, and this time we will send the transactions to a normal node, not a DS node.</p><p name="65ca" id="65ca" class="graf graf--p graf-after--p">And, that changed absolutely nothing, same TPS, I’m assuming difficulty should not be a normal int. I’ll continue this later, first time for a comparison.</p><p name="b5a6" id="b5a6" class="graf graf--p graf-after--p">Let’s quickly talk about difficulty, difficulty defines indirectly how long it will take to confirm a single block, the higher the difficulty, the longer the block will take. Ethereum is designed to take 13–15 seconds per block, so as more and more nodes enter the network the difficulty has to increase (to the insane numbers it is at now), Ethereum private (aka a cluster you set up yourself, like my Zilliqa private above), running on a difficulty of 3, can give you around 700 TPS from a few averaged tests. So raw Ethereum is actually slightly faster than Zilliqa currently.</p><p name="e044" id="e044" class="graf graf--p graf-after--p">But now we have to talk about the sharding, so at my original 10 shards, and my averaged 250 - 300 TPS, this would mean 2.5k - 3k TPS. This is already true since I can see I can run each nodes transactions in parallel to achieve this. Now to be fair, once the difficulty is increased you would be looking at much lower core TPS, which also means much lower sharded TPS, so in production in a Byzantine environment, we can apply the Ethereum private to Ethereum public 98% core reduction (based on Ethereum metrics), so around 5–6 TPS (currently), sharded to around 50 to 60 TPS on 10 shards.</p><p name="147f" id="147f" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Conclusion</strong>: This is good code, it’s well organized, it’s neatly written, and it shows an above average skillset, it does show a few junior to mid level trends, some of the error handling is reminiscent of developers that don’t have too much production ops experience, but that is something that only comes with much suffering. They have done a good job.</p><p name="64c5" id="64c5" class="graf graf--p graf-after--p">There is a but, Ethereum is implementing sharding and Casper (PoS), when this happens Ethereum throughput will see a potential of 10k TPS, where does that leave Zilliqa? They still have a lot of catching up to do, and I worry they won’t have the capacity to do it.</p><p name="ec9f" id="ec9f" class="graf graf--p graf-after--p graf--trailing">They have however built an impressive system up to here, not a production ready system yet, but a good system none the less, so I’m excited to see what future releases will bring.</p></div></div></section>
</section>
<footer><p class="p-tags">Tagged in <a href="https://medium.com/tag/blockchain" class="p-tag">Blockchain</a>, <a href="https://medium.com/tag/zilliqa" class="p-tag">Zilliqa</a>, <a href="https://medium.com/tag/crypto" class="p-tag">Crypto</a>, <a href="https://medium.com/tag/cryptocurrency" class="p-tag">Cryptocurrency</a>, <a href="https://medium.com/tag/ethereum" class="p-tag">Ethereum</a></p><p>By <a href="https://medium.com/@suchi.blackwing" class="p-author h-card">Andre Cronje</a> on <a href="https://medium.com/p/b393ecf0569a"><time class="dt-published" datetime="2018-03-16T20:41:38.923Z">March 16, 2018</time></a>.</p><p><a href="https://medium.com/@suchi.blackwing/cryptocurrency-code-review-zilliqa-b393ecf0569a" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on May 2, 2018.</p></footer></article>

</body></html>